<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Imagen → SSD1306</title>
<style>
  body { font-family: monospace; background:#111; color:#eee; }
  button { margin-top:10px; padding:6px; }
  textarea { width:100%; height:320px; margin-top:10px; }
  canvas { border:1px solid #444; margin-top:10px; image-rendering:pixelated; }
</style>
</head>
<body>

<h2>Imagen → SSD1306 (128×32)</h2>

<input type="file" id="file" accept=".bmp,.png,.jpg,.jpeg"><br>

<label>
  <input type="checkbox" id="invert"> Invertir colores
</label><br>

<button onclick="convert()">Convertir</button>

<canvas id="preview" width="128" height="32"></canvas>

<textarea id="output" placeholder="Aquí aparecerá el bitmap HEX..."></textarea>

<script>
function convert() {
  const file = document.getElementById("file").files[0];
  const invert = document.getElementById("invert").checked;
  const out = document.getElementById("output");
  const canvas = document.getElementById("preview");
  const ctx = canvas.getContext("2d");

  if (!file) {
    alert("Sube una imagen");
    return;
  }

  const img = new Image();
  img.onload = () => {
    // Dibujar y reescalar a 128x32
    ctx.clearRect(0, 0, 128, 32);
    ctx.drawImage(img, 0, 0, 128, 32);

    const imgData = ctx.getImageData(0, 0, 128, 32).data;
    let bytes = [];

    // SSD1306: 4 páginas
    for (let page = 0; page < 4; page++) {
      for (let x = 0; x < 128; x++) {
        let byte = 0;

        for (let bit = 0; bit < 8; bit++) {
          const y = page * 8 + bit;
          const i = (y * 128 + x) * 4;

          // Luminancia
          const gray =
            imgData[i] * 0.299 +
            imgData[i + 1] * 0.587 +
            imgData[i + 2] * 0.114;

          const pixel = gray > 128 ? 1 : 0;
          byte |= pixel << bit;
        }

        if (invert) byte ^= 0xFF;
        bytes.push("0x" + byte.toString(16).padStart(2, "0"));
      }
    }

    out.value = bytes.join(",");
  };

  img.src = URL.createObjectURL(file);
}
</script>

</body>
</html>
