<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BMP a OLED 128x32</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  padding: 20px;
}
input, button {
  margin: 10px 0;
}
canvas {
  border: 1px solid #555;
  image-rendering: pixelated;
}
textarea {
  width: 100%;
  height: 250px;
  background: #000;
  color: #0f0;
  font-family: monospace;
}
</style>
</head>
<body>

<h2>Conversor BMP → OLED 128x32 (Arduino)</h2>

<input type="file" id="fileInput" accept=".bmp">
<br>
<canvas id="canvas" width="128" height="32"></canvas>
<br>
<button onclick="convert()">Convertir</button>

<h3>Código Arduino</h3>
<textarea id="output"></textarea>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

document.getElementById("fileInput").addEventListener("change", e => {
  const img = new Image();
  img.onload = () => {
    ctx.clearRect(0,0,128,32);
    ctx.drawImage(img, 0, 0, 128, 32);
  };
  img.src = URL.createObjectURL(e.target.files[0]);
});

function convert() {
  const imgData = ctx.getImageData(0, 0, 128, 32).data;
  let bytes = [];
  
  for (let y = 0; y < 32; y += 8) {
    for (let x = 0; x < 128; x++) {
      let byte = 0;
      for (let bit = 0; bit < 8; bit++) {
        const i = ((y + bit) * 128 + x) * 4;
        const lum = imgData[i] + imgData[i+1] + imgData[i+2];
        if (lum < 384) byte |= (1 << bit); // pixel negro
      }
      bytes.push(byte);
    }
  }

  let result = "const unsigned char image[] PROGMEM = {\n";
  for (let i = 0; i < bytes.length; i++) {
    if (i % 16 === 0) result += "  ";
    result += "0x" + bytes[i].toString(16).padStart(2, "0") + ", ";
    if (i % 16 === 15) result += "\n";
  }
  result += "\n};";

  document.getElementById("output").value = result;
}
</script>

</body>
</html>
